<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TennisIQ Dashboard - Principal</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #000000;
            color: #fff;
            min-height: 100vh;
        }
        
        .header {
            background: rgba(0,0,0,0.8);
            padding: 20px;
            text-align: center;
            border-bottom: 2px solid #00ff00;
        }
        
        .header h1 { color: #00ff00; margin-bottom: 10px; }
        
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        
        .status-bar {
            background: linear-gradient(90deg, #1a1a1a, #2a2a2a);
            border: 1px solid #00ff00;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .status-item { text-align: center; }
        .status-label { color: #ccc; font-size: 12px; }
        .status-value { color: #00ff00; font-size: 18px; font-weight: bold; }
        
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .card {
            background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
            border: 1px solid #00ff00;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.1);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .card-title {
            color: #00ff00;
            font-size: 1.2em;
            margin: 0;
        }
        
        .refresh-btn {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .refresh-btn:hover { background: #00cc00; }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .stat-card {
            background: rgba(0, 255, 0, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #00ff00;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #ccc;
            font-size: 0.9em;
        }
        
        .partida-item {
            background: #1a1a1a;
            border: 1px solid #00ff00;
            margin: 10px 0;
            padding: 15px;
            border-radius: 8px;
        }
        
        .partida-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .jogadores { color: #FFD700; font-weight: bold; font-size: 1.1em; }
        .timing-badge {
            background: #00ff00;
            color: black;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .partida-info {
            display: flex;
            gap: 15px;
            margin-bottom: 8px;
            font-size: 14px;
            color: #ccc;
        }
        
        .partida-detalhes {
            margin-bottom: 10px;
        }
        
        .detalhes-linha {
            display: flex;
            gap: 15px;
            margin-bottom: 8px;
            font-size: 14px;
            flex-wrap: wrap;
        }
        
        .info-item {
            color: #ccc;
            background: rgba(0, 255, 0, 0.1);
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid rgba(0, 255, 0, 0.3);
        }
        
        .jogadores-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 10px 0;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border: 1px solid rgba(0, 255, 0, 0.2);
        }
        
        .jogador-stats h4 {
            color: #FFD700;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .stats-grid-mini {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4px;
            font-size: 12px;
        }
        
        .stats-grid-mini span {
            color: #bbb;
            background: rgba(0, 255, 0, 0.05);
            padding: 2px 6px;
            border-radius: 3px;
        }
        
        .tabela-comparativa {
            margin: 15px 0;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(0, 255, 0, 0.3);
        }
        
        .tabela-comparativa h4 {
            color: #FFD700;
            margin-bottom: 15px;
            text-align: center;
            font-size: 16px;
        }
        
        .stats-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        
        .stats-table th {
            background: rgba(0, 255, 0, 0.1);
            color: #FFD700;
            padding: 10px 8px;
            text-align: center;
            border: 1px solid rgba(0, 255, 0, 0.2);
        }
        
        .stats-table td {
            padding: 8px;
            text-align: center;
            border: 1px solid rgba(0, 255, 0, 0.1);
        }
        
        .jogador-col {
            font-weight: bold;
            min-width: 35%;
        }
        
        .stat-col {
            min-width: 30%;
        }
        
        .stat-nome {
            color: #ccc;
            font-weight: bold;
        }
        
        .stat-valor {
            color: #fff;
            font-weight: bold;
        }
        
        .stat-valor.melhor {
            background: rgba(0, 255, 0, 0.2);
            color: #00ff00;
        }
        
        .stat-valor.pior {
            background: rgba(255, 0, 0, 0.2);
            color: #ff6666;
        }
        
        .stat-valor.igual {
            background: rgba(255, 255, 0, 0.1);
            color: #ffff99;
        }
        
        .partida-motivo {
            font-size: 13px;
            color: #aaa;
            font-style: italic;
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #ffff00;
        }
        
        .no-data {
            text-align: center;
            padding: 40px;
            color: #aaa;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üéæ TennisIQ Dashboard</h1>
        <p>Sistema de An√°lise de T√™nis em Tempo Real</p>
    </div>

    <div class="container">
        <div class="status-bar">
            <div class="status-item">
                <div class="status-label">Bot Status</div>
                <div class="status-value" id="bot-status">‚óè</div>
            </div>
            <div class="status-item">
                <div class="status-label">√öltima Atualiza√ß√£o</div>
                <div class="status-value" id="ultima-atualizacao">--:--</div>
            </div>
            <div class="status-item">
                <div class="status-label">Requests Restantes</div>
                <div class="status-value" id="requests-restantes">----</div>
            </div>
        </div>

        <div class="grid">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìä Estat√≠sticas Gerais</h2>
                    <button class="refresh-btn" onclick="carregarDados()">üîÑ</button>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="total-partidas">0</div>
                        <div class="stat-label">Partidas Analisadas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="sinais-gerados">0</div>
                        <div class="stat-label">Sinais Gerados</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="taxa-sucesso">0%</div>
                        <div class="stat-label">Taxa de Sucesso</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="ev-medio">0.000</div>
                        <div class="stat-label">EV M√©dio</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üéØ Estrat√©gias Utilizadas</h2>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="sinais-invertidos">0</div>
                        <div class="stat-label">Sinais Invertidos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="sinais-tradicionais">0</div>
                        <div class="stat-label">Sinais Tradicionais</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="filtros-timing">0</div>
                        <div class="stat-label">Filtros Timing</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="filtros-ev">0</div>
                        <div class="stat-label">Filtros EV</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card full-width">
            <div class="card-header">
                <h2 class="card-title">üèÉ Partidas Analisadas Recentes</h2>
                <button class="refresh-btn" onclick="mostrarPartidas()">üîÑ</button>
            </div>
            <div id="partidas-container">
                <div class="loading">üîÑ Carregando partidas...</div>
            </div>
        </div>
    </div>

    <script>
        let dados = {};

        async function carregarDados() {
            try {
                const response = await fetch('/api/dados');
                dados = await response.json();
                
                // Atualizar status do bot
                const botStatusEl = document.getElementById('bot-status');
                if (botStatusEl) {
                    botStatusEl.textContent = dados.bot_status?.ativo ? 'üü¢ ATIVO' : 'üî¥ INATIVO';
                    botStatusEl.style.color = dados.bot_status?.ativo ? '#00ff00' : '#ff0000';
                }
                
                // Atualizar √∫ltima atualiza√ß√£o
                const ultimaAtEl = document.getElementById('ultima-atualizacao');
                if (ultimaAtEl && dados.bot_status?.ultimo_update) {
                    ultimaAtEl.textContent = new Date(dados.bot_status.ultimo_update).toLocaleTimeString();
                }
                
                // Atualizar requests
                const requestsEl = document.getElementById('requests-restantes');
                if (requestsEl) {
                    requestsEl.textContent = dados.bot_status?.requests_restantes || 0;
                }
                
                // Atualizar estat√≠sticas b√°sicas
                if (dados.estatisticas) {
                    const stats = dados.estatisticas;
                    // Usar partidas_aprovadas_filtro (valor em tempo real do terminal) ao inv√©s de total_partidas
                    document.getElementById('total-partidas').textContent = stats.partidas_aprovadas_filtro || 0;
                    document.getElementById('sinais-gerados').textContent = stats.total_sinais || 0;
                    document.getElementById('taxa-sucesso').textContent = (stats.taxa_sucesso || 0).toFixed(1) + '%';
                    document.getElementById('ev-medio').textContent = (stats.ev_medio || 0).toFixed(3);
                    document.getElementById('sinais-invertidos').textContent = stats.sinais_invertidos || 0;
                    document.getElementById('sinais-tradicionais').textContent = stats.sinais_tradicionais || 0;
                }
                
                // Atualizar partidas
                mostrarPartidas();
                
            } catch (error) {
                const container = document.getElementById('partidas-container');
                if (container) {
                    container.innerHTML = `
                        <div style="background: red; color: white; padding: 15px; border-radius: 5px;">
                            ‚ùå Erro ao carregar dados: ${error.message}
                        </div>
                    `;
                }
            }
        }

        function mostrarPartidas() {
            const container = document.getElementById('partidas-container');
            if (!container) {
                return;
            }
            
            const partidas = dados.partidas_analisadas || [];
            
            if (partidas.length === 0) {
                container.innerHTML = '<div class="loading">üì≠ Nenhuma partida encontrada</div>';
                return;
            }

            // Manter apenas a vers√£o mais recente de cada partida (mesmo jogadores)
            const partidasMaisRecentes = {};
            
            partidas.forEach(partida => {
                // Chave baseada apenas nos jogadores (para partidas ao vivo)
                const chaveJogadores = `${partida.jogador1.trim()}_vs_${partida.jogador2.trim()}`;
                const timestamp = partida.timestamp || '';
                
                // Se n√£o tem essa partida ou se esta √© mais recente, substitui
                if (!partidasMaisRecentes[chaveJogadores] || timestamp > (partidasMaisRecentes[chaveJogadores].timestamp || '')) {
                    partidasMaisRecentes[chaveJogadores] = partida;
                }
            });
            
            // Converter de volta para array
            const partidasUnicas = Object.values(partidasMaisRecentes);
            
            // Ordenar partidas por timestamp (mais recentes primeiro)
            const partidasOrdenadas = partidasUnicas.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            const html = partidasOrdenadas.map((partida, index) => {
                // Usar apenas dados reais dos jogadores
                const statsJ1 = partida.stats_jogador1 || {};
                const statsJ2 = partida.stats_jogador2 || {};
                
                // Verificar se h√° dados reais dispon√≠veis (basta ter pelo menos uma propriedade)
                const temDadosReais = Object.keys(statsJ1).length > 0 || Object.keys(statsJ2).length > 0;                return `
                <div class="partida-item">
                    <div class="partida-header">
                        <div class="jogadores">${partida.jogador1} vs ${partida.jogador2}</div>
                        <span class="timing-badge">Timing: ${partida.timing_priority}/5</span>
                    </div>
                    <div class="partida-detalhes">
                        <div class="detalhes-linha">
                            <span class="info-item">üìä <strong>Placar:</strong> ${partida.placar}</span>
                            <span class="info-item">üéØ <strong>Decis√£o:</strong> ${partida.decisao}</span>
                            <span class="info-item">üïê <strong>Hor√°rio:</strong> ${new Date(partida.timestamp).toLocaleTimeString()}</span>
                        </div>
                    </div>
                    
                    ${temDadosReais ? `
                    <!-- TABELA COMPARATIVA DOS JOGADORES - DADOS REAIS -->
                    <div class="tabela-comparativa">
                        <h4>üèÜ Compara√ß√£o Detalhada (Dados Reais)</h4>
                        <table class="stats-table">
                            <thead>
                                <tr>
                                    <th class="jogador-col">${partida.jogador1}</th>
                                    <th class="stat-col">Estat√≠stica</th>
                                    <th class="jogador-col">${partida.jogador2}</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="stat-valor ${(statsJ1.aces || 0) > (statsJ2.aces || 0) ? 'melhor' : (statsJ1.aces || 0) < (statsJ2.aces || 0) ? 'pior' : 'igual'}">${statsJ1.aces || 0}</td>
                                    <td class="stat-nome">üéæ Aces</td>
                                    <td class="stat-valor ${(statsJ2.aces || 0) > (statsJ1.aces || 0) ? 'melhor' : (statsJ2.aces || 0) < (statsJ1.aces || 0) ? 'pior' : 'igual'}">${statsJ2.aces || 0}</td>
                                </tr>
                                <tr>
                                    <td class="stat-valor ${(statsJ1.double_faults || 0) < (statsJ2.double_faults || 0) ? 'melhor' : (statsJ1.double_faults || 0) > (statsJ2.double_faults || 0) ? 'pior' : 'igual'}">${statsJ1.double_faults || 0}</td>
                                    <td class="stat-nome">‚ùå Double Faults</td>
                                    <td class="stat-valor ${(statsJ2.double_faults || 0) < (statsJ1.double_faults || 0) ? 'melhor' : (statsJ2.double_faults || 0) > (statsJ1.double_faults || 0) ? 'pior' : 'igual'}">${statsJ2.double_faults || 0}</td>
                                </tr>
                                <tr>
                                    <td class="stat-valor ${(statsJ1.win_first_serve || 0) > (statsJ2.win_first_serve || 0) ? 'melhor' : (statsJ1.win_first_serve || 0) < (statsJ2.win_first_serve || 0) ? 'pior' : 'igual'}">${statsJ1.win_first_serve || 0}%</td>
                                    <td class="stat-nome">‚úÖ Win 1st Serve</td>
                                    <td class="stat-valor ${(statsJ2.win_first_serve || 0) > (statsJ1.win_first_serve || 0) ? 'melhor' : (statsJ2.win_first_serve || 0) < (statsJ1.win_first_serve || 0) ? 'pior' : 'igual'}">${statsJ2.win_first_serve || 0}%</td>
                                </tr>
                                <tr>
                                    <td class="stat-valor ${(statsJ1.break_points_converted || 0) > (statsJ2.break_points_converted || 0) ? 'melhor' : (statsJ1.break_points_converted || 0) < (statsJ2.break_points_converted || 0) ? 'pior' : 'igual'}">${statsJ1.break_points_converted || 0}%</td>
                                    <td class="stat-nome">‚ö° Break Points</td>
                                    <td class="stat-valor ${(statsJ2.break_points_converted || 0) > (statsJ1.break_points_converted || 0) ? 'melhor' : (statsJ2.break_points_converted || 0) < (statsJ1.break_points_converted || 0) ? 'pior' : 'igual'}">${statsJ2.break_points_converted || 0}%</td>
                                </tr>
                                <tr>
                                    <td class="stat-valor ${(statsJ1.momentum_score || 0) > (statsJ2.momentum_score || 0) ? 'melhor' : (statsJ1.momentum_score || 0) < (statsJ2.momentum_score || 0) ? 'pior' : 'igual'}">${(statsJ1.momentum_score || 0).toFixed(1)}%</td>
                                    <td class="stat-nome">üìà Momentum Score</td>
                                    <td class="stat-valor ${(statsJ2.momentum_score || 0) > (statsJ1.momentum_score || 0) ? 'melhor' : (statsJ2.momentum_score || 0) < (statsJ1.momentum_score || 0) ? 'pior' : 'igual'}">${(statsJ2.momentum_score || 0).toFixed(1)}%</td>
                                </tr>
                                <tr>
                                    <td class="stat-valor ${(statsJ1.mental_score || 0) > (statsJ2.mental_score || 0) ? 'melhor' : (statsJ1.mental_score || 0) < (statsJ2.mental_score || 0) ? 'pior' : 'igual'}">${(statsJ1.mental_score || 0).toFixed(0)}</td>
                                    <td class="stat-nome">üß† Score Mental</td>
                                    <td class="stat-valor ${(statsJ2.mental_score || 0) > (statsJ1.mental_score || 0) ? 'melhor' : (statsJ2.mental_score || 0) < (statsJ1.mental_score || 0) ? 'pior' : 'igual'}">${(statsJ2.mental_score || 0).toFixed(0)}</td>
                                </tr>
                                <tr>
                                    <td class="stat-valor ${(statsJ1.ev || 0) > (statsJ2.ev || 0) ? 'melhor' : (statsJ1.ev || 0) < (statsJ2.ev || 0) ? 'pior' : 'igual'}">${(statsJ1.ev || 0).toFixed(3)}</td>
                                    <td class="stat-nome">üí∞ EV</td>
                                    <td class="stat-valor ${(statsJ2.ev || 0) > (statsJ1.ev || 0) ? 'melhor' : (statsJ2.ev || 0) < (statsJ1.ev || 0) ? 'pior' : 'igual'}">${(statsJ2.ev || 0).toFixed(3)}</td>
                                </tr>
                                <tr>
                                    <td class="stat-valor">${partida.odds1 || 'N/A'}</td>
                                    <td class="stat-nome">üéØ Odds</td>
                                    <td class="stat-valor">${partida.odds2 || 'N/A'}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    ` : `
                    <!-- MENSAGEM QUANDO N√ÉO H√Å DADOS REAIS -->
                    <div class="tabela-comparativa">
                        <h4>‚è≥ Coletando Estat√≠sticas Reais...</h4>
                        <p style="text-align: center; color: #ccc; font-style: italic;">
                            üìä Aguardando dados detalhados dos jogadores da API.<br>
                            üîÑ As estat√≠sticas ser√£o exibidas quando dispon√≠veis.
                        </p>
                    </div>
                    `}
                    
                    <div class="partida-motivo">${partida.motivo}</div>
                </div>
                `;
            }).join('');

            container.innerHTML = html;
        }

        // Carregar dados iniciais
        carregarDados();

        // Atualizar automaticamente a cada 30 segundos
        setInterval(carregarDados, 30000);
    </script>
</body>
</html>
